(self.webpackChunk_mail_octavius=self.webpackChunk_mail_octavius||[]).push([[9318],{69318:function(t,n){!function(t){"use strict";var n=function(){return(n=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var a in n=arguments[e])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)},e=window;function o(){}function a(t){(new Image).src="https://stat.radar.imgsmail.ru/update?v=1&p=oauth2&t=jssdk&i="+t+":1"}var i="__mr_oauth2__";function c(t,n,e){try{var o=window.localStorage,a="".concat(i,".").concat(t),c="ttl_".concat(i,".").concat(t);if(1===arguments.length){var r=parseInt(o.getItem(c),10);if(!r||r>Date.now())return JSON.parse(o.getItem(a))}else 0<=e&&o.setItem(c,"".concat(Date.now()+1e3*e)),o.setItem(a,JSON.stringify(n))}catch(t){}return null}function r(t){return document.createElement(t)}function l(t,n){t.appendChild(n)}function s(t){try{t.parentNode.removeChild(t)}catch(t){}}function u(t,n){if(t)for(var e in n)n.hasOwnProperty(e)&&(t.style[e]=n[e])}var d="unknown",f="connected",p="not_authorized",h="default",g="onetap",m="hidden",_="embedded",v="ru-RU",b="userinfo",y="mail.phone",w="full-fit",O="mailru-login-button",E="login";t.OAUTH_HOST="https://o2.mail.ru";var x="__mailru_oauth_".concat(Date.now(),"_").concat(Math.random(),"__"),k="".concat(location.protocol,"//").concat(location.host),S={ui:1,type:1,lang:1,auth:!1},I=/^data-/,T=/^on(load|error|(?:before)?click|login|logout)$/,L=/^https?:/,U=/[?&]lang=([^a-z_-]+)/i,C={},M=[],N=[],A=[],H="o2_mail_ru_popup_login",P="close_state",D="login_state",R=1,z=!1,j={clientId:null},B=window,J=B.document,F={btn:"jsapi/button",login:"login",logout:"jsapi/logout",userinfo:"userinfo"},G=[],W=!1,X=!1,Y=null,V=null,q=null,K=null,Z=d,$=null,Q=null,tt=[];function nt(t,n){return"".concat(t,":").concat(n)}function et(n,e){var o="".concat(F[n])+"?client_id=".concat(j.clientId)+"&redirect_uri=".concat(k)+(e.lang?"":"&lang=".concat(j.lang));return j.recaptcha,L.test(o)||(o="".concat(t.OAUTH_HOST,"/").concat(o)),"".concat(o,"&").concat(function(t){var n="";for(var e in t)t.hasOwnProperty(e)&&"function"!=typeof e&&null!=t[e]&&(n+="&".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t[e])));return n.substr(1)}(e))}function ot(t){mt("call logout"),Z=Z===f?p:d,V=Q=$=null,tt.forEach((function(t){t.send("auth",Z)}));var n=rt(!0);lt(t,n),lt(j.onlogin,n),lt(j.onlogout,n),c(D,null)}function at(){mt("globalOnLogin invoked"),function(){var t=rt(),n=t.user;mt("refresh all prorts",t),tt.forEach((function(e){e.send("auth",t.status),n&&e.send("auth:user",n)}))}(),lt(j.onlogin,rt())}function it(t,n){function e(t){function e(){at(),Y.close(),lt(N,rt()),X=!1,V=null,N.length=0}mt("login resolved",{ok:t,options:n}),t&&!1!==n.userinfo?ct(e):e()}if(void 0===n&&(n={}),null==n.mode&&(n.mode=h),mt("call login",{options:n,authUser:!!$}),$)lt(t,rt());else{if(t&&N.push(t),X)return;if(q){try{q.close()}catch(t){}q=null,B.clearInterval(K)}Y=function(t){var n=R++,e=function(t){var n=t.mode;return n===g&&!W||n===_&&!0}(t),o=st(e,n,t),i="popup_".concat(e?"embedded_":"").concat(t.mode,"_");return mt("openPortal",{id:n,embedded:e,options:t}),e?function(t){var n=t.id,e=t.loginUrl,o=t.radarPrefix,i=t.options;mt("open embedded portal:",n,e,o,i);var c=r("div"),d=r("div"),f=r("iframe"),p=pt(n,f,{embedded:!0,root:c,onClose:function(){s(d)}}),m=vt(),v=m<=530,b=v?10:20,y=v?m-2*b:490,w=bt()-2*b,O=i.mode===_;f.src=e,f.frameBorder="no",f.width=y+"",f.height="10",f.scrolling="no",u(f,{transform:"translate(0) scale(1,1)"}),u(c,{width:"".concat(f.width,"px"),height:"10px",position:"fixed",opacity:"0",borderRadius:"4px",transform:"translate(0, 20px)",boxShadow:"rgba(0,0,0,.16) 0 4px 20px",zIndex:"2147483647",overflow:"hidden",background:"#fff",pointerEvents:"none"}),O?(u(c,{top:"50%",left:"50%"}),u(d,{left:"0",top:"0",right:"0",bottom:"0",position:"fixed",zIndex:"2147483646",background:"rgba(0,0,0,.5)",display:"flex",alignItems:"center",justifyContent:"center"}),d.innerHTML='<div style="width: 64px; height: 64px">'.concat(function(t,n){void 0===n&&(n="1.5s");for(var e="_".concat(Date.now()),o="".concat(e,"-spin"),a="",i=-146,c=0;i<=92;i+=2)a+='<use fill="rgb('.concat(c+=2,",").concat(c,",").concat(c,')" xlink:href="#a" transform="rotate(').concat(i,' 32 32)"/>');return"\n\t<style>\n\t.".concat(e," {\n\t\twidth: 64px;\n\t\theight: 64px;\n\t\tdisplay: inline-block;\n\t\t-webkit-animation: ").concat(o," ").concat(n," linear infinite;\n\t\t-moz-animation: ").concat(o," ").concat(n," linear infinite;\n\t\tanimation: ").concat(o," ").concat(n," linear infinite;\n\t}\n\t@-moz-keyframes ").concat(o," { 100% { -moz-transform: rotate(360deg); } }\n\t@-webkit-keyframes ").concat(o," { 100% { -webkit-transform: rotate(360deg); } }\n\t@keyframes ").concat(o,' { 100% { -webkit-transform: rotate(360deg); transform:rotate(360deg); } }\n\t</style>\n\t<div class="').concat(e,'"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64">\n\t\t<defs>\n\t\t\t<path id="a" d="M0 0h32v32H0z"></path>\n\t\t\t<mask id="progress">\n\t\t\t\t<path d="M0 0h64v64H0z"></path>\n\t\t\t\t').concat(a,'\n\t\t\t</mask>\n\t\t</defs>\n\t\t<path fill="').concat(t,'" d="M54.6 47.6c-1.98-1.98-5.09-1.98-7.07 0-8.56 8.56-22.6 8.56-31.1 0-8.56-8.56-8.56-22.6 0-31.1 4.54-5.58-3.25-10.7-7.07-7.07-12.4 12.4-12.4 32.8 0 45.3 12.4 12.4 32.8 12.4 45.3 0 1.98-1.98 1.98-5.09 0-7.07zM32 54c-12.1 0-22-9.9-22-22s9.9-22 22-22c2.8 0 5-2.2 5-5s-2.2-5-5-5C14.4 0 0 14.4 0 32s14.4 32 32 32c7.16-.736 5.26-9.84 0-10z" mask="url(#progress)">\n\t\t</path>\n\t</svg></div>\n').trim()}("#fff"),"</div>")):u(c,{top:"".concat(b,"px"),right:"".concat(b,"px")}),l(c,f),l(J.body,d),l(J.body,c),a("".concat(o,"try_open")),p.on("connect",(function(){a("".concat(o,"connected")),Y.send("connected",{})}));var E=null,x=function(t){var n,e=[],o=!1;function a(t){t(n)}return function(t){p.on("repaint",(function(n){var e=n.rect,o=Y.el,a=o.parentElement,i=Math.min(e.height,w);100<e.height&&(o.height=i+"",o.width=y+"",o.scrolling=e.height>w?"yes":"no",u(a,{width:"".concat(y,"px"),height:"".concat(o.height,"px")}),(E=function(t){t&&u(a,{marginTop:"-".concat(i/2,"px"),marginLeft:"-".concat(y/2,"px")})})(O),t())}))}((function(t){o||(n=t,o=!0,e.forEach(a),e.length=0)})),{then:function(t){o?a(t):e.push(t)}}}();return p.on("ready",(function(t){var n=t.hidden;function e(t){return x.then((function(){if(!l){var n=O?".6s ease-out":".25s";return E(O),t&&t.position?"center"===t.position?(u(c,{top:"50%",left:"50%"}),E(!0)):(u(c,{top:t.position.top,left:t.position.left}),E(!1)):E(O),f.getBoundingClientRect(),d.textContent="",u(c,{pointerEvents:"",opacity:"1",transform:"translate(0, 0)",transition:"transform ".concat(n,", opacity ").concat(n)}),ut(i),setTimeout((function(){u(c,{transition:"height .15s ease-out"})}),1e3),!0}gt("Can't show OneTap, because it already closed (it's zombie)")}))}function r(){return x.then((function(){if(!l)return l=!0,p.simulate("cancel"),!0;gt("OneTap is already closed (it's zombie)")}))}a("".concat(o,"ready")),a("".concat(o,"ready_hidden_").concat(n));var l=!1;if(n)ft(i);else{var s=!1;ft(i,(function(){return s=!0,{show:e,close:r}})),s||e()}})),p.on("open:login",(function(t){var n=t.email;a("".concat(o,"open_login")),p.close(),it(null,{email:n,embedded:X=!1})})),p.on("unavailable",(function(t){var n=t.mode;a("".concat(o,"unavailable_").concat(n)),n===g&&(W=!(X=!1),j.mode=h,j.autoLogin=!1),lt(j.onunavailable,{mode:i.mode}),p.close()})),p}({id:n,loginUrl:o,options:t,radarPrefix:i}):V?(mt("using proxy port",n),a("".concat(i,"_create_proxy_port")),ut(t),pt(n,{postMessage:function(t){V.send("login:proxy",t)}},{embedded:e})):(mt("create popup portal",n),a("".concat(i,"_create_popup")),ut(t),q=function t(n){try{return B.open(o,n,yt())}catch(e){return"_blank"!==n?t("_blank"):null}}(H),K=B.setInterval((function(){try{if(!q.top||q.closed)throw"Y"}catch(t){_t(n,"login:closed",{}),B.clearInterval(K)}}),100),pt(n,q,{embedded:!1}))}(n),X=!0,Y.embedded?(Y.on("cancel",(function(){X=!1,mt("embedded portal[login] canceled"),c(P,!0,j.ttlCloseState),a("popup_embedded_".concat(n.mode,"_canceled")),e(!1),dt(n)})),M.push((function(){mt("embedded portal[login] resolved"),e(!0)}))):(V||Y).on("login:closed",(function(){mt("portal[login] closed"),a("popup_".concat(n.mode,"_closed_proxy")),e(!0),dt(n)}))}}function ct(t){$?t($):(A.push(t),1===A.length&&function(t,n){!function(t,n){var a,i=function(t){!t&&4!==a.readyState||(t=t||200!==a.status&&201!==a.status,i=o,a.onreadystatechange=null,n(!!t,a))};try{a=new e.XMLHttpRequest}catch(t){try{a=new e.ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{a=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){(a={readyState:4,status:-1}).open=a.send=o}}}a.onerror=function(t){a.onerror=null,i(t)};try{a.open("GET",t,!0),a.send(null),a.onreadystatechange=function(){i()}}catch(t){i(t)}}(t,(function(t,e){if(t)n(t,null);else try{n(t,JSON.parse(e.responseText))}catch(t){n(t,null)}}))}(et("userinfo",{access_token:Q}),(function(t,n){!function(t){return!(t&&t.hasOwnProperty("error"))}(n)||($=n,Z=f),lt(A,$),A.length=0})))}function rt(t){return{status:Z,user:t?null:$,access_token:t?null:Q}}function lt(t,n){if(t instanceof Array)t.forEach((function(t){lt(t,n)}));else try{t&&t.call(null,n)}catch(t){gt(t.stack)}}function st(t,n,e){return et("login",{scope:j.scopes.join(" "),response_type:"token",embedded:t?"Y":null,mode:e.mode,state:JSON.stringify({cid:n,loginState:c(D),ttlLoginState:j.ttlLoginState,skin:j.skin||"default",txtExp:j.txtExp||"default"}),login:e.email})}function ut(t){lt(j.onshow,{mode:t.mode})}function dt(t){lt(j.onclose,{mode:t.mode})}function ft(t,n){lt(j.onready,{mode:t.mode,onetap:n?{capture:n}:void 0})}function pt(n,e,o){var a=o.root||e,i={el:e,embedded:o.embedded,root:a,send:function(o,a){var i=JSON.stringify({cid:n,type:o,detail:a});mt("[port] send: ".concat(o,", detail:"),a);try{e.contentWindow.postMessage(i,t.OAUTH_HOST)}catch(o){try{e.postMessage(i,t.OAUTH_HOST)}catch(o){}}},simulate:function(t,e){void 0===e&&(e={}),B.postMessage(JSON.stringify({cid:n,type:t,detail:e}),"*")},on:function(t,e,o){return e&&function(t,n,e,o){var a=nt(t,n);if(C.hasOwnProperty(a)||(C[a]=[]),o)C[a].push((function o(){!function(t,n,e){var o=nt(t,n);if(C.hasOwnProperty(o)){var a=C[o].indexOf(e);-1<a&&C[o].splice(a,1)}}(t,n,o),e.apply(null,arguments)}));else C[a].push(e)}(n,t,e,o),this},close:function(){this.send("login:close",{}),s(a),function(t){var n=new RegExp("^".concat(nt(t,"")));for(var e in C)n.test(e)&&delete C[e]}(n),lt(o.onClose,[]),a=e=null}};return mt("[port] created: ".concat(n,", iframe: ").concat(e instanceof HTMLIFrameElement)),i}function ht(t){if(t[x]!==x){t[x]=x,u(t,{position:"relative"});var n=function(t,n){for(var e=t.attributes.length;e--;){var o=t.attributes[e],a=o.name,i=o.value,c=I.test(a)?a.substr(5):null;c&&(T.test(c)?(B[i]||gt("Callback '".concat(a,'="').concat(i,"\"' not found")),n[c]=B[i]):S[c]&&(n[c]=i))}return n}(t,{cid:R++,type:E,ui:""}),e=r("iframe"),o=pt(n.cid,e,{embedded:!1});e.width="100%",e.height="100%",u(e,{display:"inline-block",verticalAlign:"middle",borderRadius:"2px",transition:"all .1s ease-out"});var i=function(){return o.send("login:cfg",{url:st(!1,n.cid,{mode:h,modern:!0}),name:H,embedded:j.mode===_,width:490,height:500,params:yt()})};t.addEventListener("focusin",(function(){i()})),t.addEventListener("mouseover",(function(){i()})),t.addEventListener("touchstart",(function(){i()})),o.on("load",(function(t){mt("port[button] loaded",n.cid),i(),tt.push(o),-1<n.ui.indexOf(w)&&o.on("resize",(function(t){var n=t.width,o=t.height;e.width=n,e.height=o})),o.on("beforeclick",(function(t){tt.forEach((function(t){t!==o&&t.send("login:close",{})})),lt(n.onbeforeclick,t)})),o.on("open:embedded",(function(){mt("port[button] invoke embedded login",n.cid),it(null,{mode:_})})),o.on("click",(function(t){$?(a("button_logout_click"),ot(n.onlogout)):(a("button_login_click"),V=o,it(n.onlogin)),lt(n.onclick,t)})),a("button_onload_".concat(t.status)),lt(n.onload,t)}),!0),e.onerror=function(){gt("[transport] Internal error"),a("transport_error"),lt(n.onerror,rt(!0))},e.setAttribute("frameborder","0"),e.scrolling="no",l(t,e),e.src=et("btn",n),mt("port[button] created",n)}}function gt(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];G.push("warn",t)}function mt(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];G.push("info",t)}function _t(t,n,e){var o=nt(t,n);C.hasOwnProperty(o)&&lt(C[o],e)}function vt(){return B.innerWidth||J.documentElement.clientWidth}function bt(){return B.innerHeight||J.documentElement.clientHeight}function yt(){var t=B.screen,n=null!=B.screenLeft?B.screenLeft:t.left,e=null!=B.screenTop?B.screenTop:t.top,o=vt()||t.width,a=bt()||t.height;return["scrollbars=no","left=".concat((o-490)/2+(parseInt(n,10)||0)),"top=".concat((a-500)/2.3+(parseInt(e,10)||0)),"width=".concat(490),"height=".concat(500)].join(",")}function wt(n){var e=n.origin,o=n.data;if(""!==o&&e===t.OAUTH_HOST)try{mt("message",o);var i=JSON.parse(o),r=i.cid,l=i.type,s=i.detail;switch(_t(r,l,s),l){case"load":Z=s.status,a("message_load_auth_status_".concat(s.status));break;case"auth":a("message_auth_status_".concat(s.status)),function(t){Q=t||null,M.splice(0,1e6).forEach((function(t){t({status:Q?f:p,access_token:Q})})),Q&&j.ttlLoginState&&c(D,!0,j.ttlLoginState)}(s.access_token)}}catch(n){gt(n.stack||n.message)}}setInterval((function(){tt=tt.filter((function(t){if(function(t){return"IFRAME"===t.nodeName}(t.el)){for(var n=t.el;n=n.parentNode;)if(n===J.body)return!0;return mt("[gc] port removed:",t),!1}return!0}))}),3e4),t.AUTH_CONNECTED=f,t.AUTH_NOT_AUTHORIZED=p,t.AUTH_UNKNOWN=d,t.BUTTON_CLASSNAME=O,t.BUTTON_TYPE_LOGIN=E,t.LANG_EN="en-US",t.LANG_RU=v,t.MODE_DEFAULT=h,t.MODE_EMBEDDED=_,t.MODE_HIDDEN=m,t.MODE_ONETAP=g,t.MODE_XHR="xhr",t.SCOPE_CLOUD_API="cloud.api",t.SCOPE_CLOUD_DND="cloud.openapi.dnd",t.SCOPE_DOCS_VIEW="mail.api.documents.view",t.SCOPE_MAIL_IMAP="mail.imap",t.SCOPE_MAIL_PHONE=y,t.SCOPE_USER_INFO=b,t.UI_ALWAYS_LOGIN="always_login",t.UI_FULL_FIT=w,t.UI_LOGIN_AS="login_as",t.UI_USERPIC="userpic",t.__DEV__=function(t){},t.auth=function(t){var e=R++,o=r("iframe");mt("call auth"),u(o,{visibility:"hidden",position:"absolute",left:"-999px",top:"-999px"}),_===j.mode?M.push((function(n){var e=-1!==j.scopes.indexOf(b);s(o),n.status===f?e?ct((function(){mt("auth successfully with userinfo",rt()),lt(t,rt()),at()})):(mt("auth successfully",n),lt(t,n),at()):(gt("User not authorized:",n),it(t,{userinfo:e,mode:_}))})):M.push(t);var a=j.login;o.src=et("login",n(n({scope:j.scopes.join(" ")},a&&{login:a}),{response_type:"token",mode:m,state:"cid=".concat(e,"&e=").concat(x)})),l(J.body,o)},t.getRuntimeLog=function(){return G},t.getState=function(){return rt()},t.getUser=ct,t.init=function(t){if(z)mt("reinit",t);else{if(mt("init",t),!t)throw new Error("[MR.init] `options` not defined");if(z=!0,!(j=t).clientId)throw new Error("[MR.init] `options.clientId` not defined");null==t.lang&&(t.lang=(B.location.toString().match(U)||[])[1]||B.navigator.language||B.navigator.languages&&B.navigator.languages[0]||v),mt("[button] lang: ".concat(t.lang," (nav: ").concat(B.navigator.language,", [").concat(B.navigator.languages,"]")),null==t.scopes&&(t.scopes=[b]),null==t.modern&&(t.modern=-1<t.scopes.indexOf(y)||-1<location.toString().indexOf("o2.modern")),null==t.mode&&(t.mode=h),null==t.ttlCloseState&&(t.ttlCloseState=2592e3),null==t.ttlLoginState&&(t.ttlLoginState=t.mode===g?604800:0),t.mode===g&&(!c(P)||t.ttlCloseState<=0)&&(mt("onetap autologin"),it(null,{mode:g})),B.addEventListener("message",wt,!1)}!function(t){for(var n=J.getElementsByClassName(O),e=n.length;e--;)t(n[e])}(ht)},t.login=it,t.logout=ot,t.reset=function(){c(P,null),c(D,null)},t.setOAuthHost=function(n){t.OAUTH_HOST=n},Object.defineProperty(t,"__esModule",{value:!0})}(n)}}]);