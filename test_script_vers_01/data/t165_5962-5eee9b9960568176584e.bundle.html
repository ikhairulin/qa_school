"use strict";(self.webpackChunk_mail_octavius=self.webpackChunk_mail_octavius||[]).push([[5962],{75962:function(t,n,e){e.r(n),e.d(n,{fetchCalendars:function(){return U},fetchEvents:function(){return M},fetchNearbyEvents:function(){return S}});var r,o,a,i,u,c,l=e(75975),f=e(90004),s=e(17692),d=e(6654),h=e(17746),p=e(41489),v=e(46739),y=e(58613),w=e(18053),b=e(57045),m=e(21211),k=e(33350),P=function(){return(P=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])if(Object.prototype.hasOwnProperty.call(n,o))t[o]=n[o];return t}).apply(this,arguments)},$=function(t,n,e,r){return new(e||(e=Promise))((function(o,a){function i(t){try{c(r.next(t))}catch(t){a(t)}}function u(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(i,u)}c((r=r.apply(t,n||[])).next())}))},g=function(t,n){var e,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;if(r=0,o)a=[2&a[0],o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}if(o[2])i.ops.pop();i.trys.pop();continue}a=n.call(t,i)}catch(t){a=[6,t],r=0}finally{e=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},x=b.ZP.get("clnd-oauth-token",{email:!0}),L=function(t){if(void 0===t)t=!1;return $(void 0,void 0,void 0,(function(){return g(this,(function(n){switch(n.label){case 0:if(x&&!t)return[2,x];else return[4,(0,w.Z)(w.K.Calendar)];case 1:return x=n.sent(),b.ZP.set("clnd-oauth-token",x,{email:!0}),[2,x]}}))}))},_=(r=function(){return{authLink:(0,v.v)((function(t,n){var e=n.headers;return $(void 0,void 0,void 0,(function(){var n,r,o,a;return g(this,(function(i){switch(i.label){case 0:if(n=(0,k.S)(t.query),r={},0===n.indexOf("mutation"))window.lastMutationTimestamp=Date.now();else o=window.lastMutationTimestamp?Math.ceil((Date.now()-window.lastMutationTimestamp)/1e3):-1,r={"X-Last-Mutation-Age":"".concat(o)};return[4,L()];case 1:return a=i.sent(),[2,{headers:P(P(P({},e),r),{"X-Email":window.__PH.activeUser(),authorization:"Bearer ".concat(a)})}]}}))}))})),errorLink:(0,y.q)((function(t){var n=t.graphQLErrors,e=t.operation,r=t.forward;if(null==n?void 0:n.find((function(t){var n=t.message;return/token_invalid|no_auth/.test(n)})))return(0,f.p)(new Promise((function(t){return setTimeout(t,300)})).then((function(){return L(!0)}))).flatMap((function(t){var n=e.getContext().headers;return e.setContext({headers:P(P({},n),{authorization:"Bearer ".concat(t)})}),r(e)}))})),httpLink:new s.u({uri:m.CALENDAR_GRAPHQL_API_URL})}}(),o=r.errorLink,a=r.authLink,i=r.httpLink,new d.f({link:h.i.from([o,a,i]),cache:new p.h})),q=e(15999),D=function(t,n){if(Object.defineProperty)Object.defineProperty(t,"raw",{value:n});else t.raw=n;return t},T=(0,q.Ps)(u||(u=D(["\n\tquery FetchCalendars {\n\t\tcalendars(onlyAccepted: true) {\n\t\t\tuid\n\t\t\tisDefault\n\t\t}\n\t}\n"],["\n\tquery FetchCalendars {\n\t\tcalendars(onlyAccepted: true) {\n\t\t\tuid\n\t\t\tisDefault\n\t\t}\n\t}\n"]))),C=function(t,n){if(Object.defineProperty)Object.defineProperty(t,"raw",{value:n});else t.raw=n;return t},E=(0,q.Ps)(c||(c=C(["\n\tquery FetchEvents($from: Time!, $to: Time!, $calendars: [UID!]) {\n\t\tevents(from: $from, to: $to, calendars: $calendars, buildVirtual: true) {\n\t\t\tuid\n\t\t\tfrom\n\t\t\tto\n\t\t\tfullDay\n\t\t\ttitle\n\t\t}\n\t}\n"],["\n\tquery FetchEvents($from: Time!, $to: Time!, $calendars: [UID!]) {\n\t\tevents(from: $from, to: $to, calendars: $calendars, buildVirtual: true) {\n\t\t\tuid\n\t\t\tfrom\n\t\t\tto\n\t\t\tfullDay\n\t\t\ttitle\n\t\t}\n\t}\n"]))),O=e(20879),A=function(t,n,e,r){return new(e||(e=Promise))((function(o,a){function i(t){try{c(r.next(t))}catch(t){a(t)}}function u(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(i,u)}c((r=r.apply(t,n||[])).next())}))},j=function(t,n){var e,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;if(r=0,o)a=[2&a[0],o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}if(o[2])i.ops.pop();i.trys.pop();continue}a=n.call(t,i)}catch(t){a=[6,t],r=0}finally{e=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},M=function(t){var n=t.calendarsUids,e=t.from,r=t.to;return _.query({query:E,variables:{calendars:n,from:(0,O.$)(e),to:(0,O.$)(r)},fetchPolicy:"network-only"})},U=function(){return _.query({query:T,fetchPolicy:"network-only"})},S=function(t){if(void 0===t)t=2;return A(void 0,void 0,void 0,(function(){var n,e;return j(this,(function(r){switch(r.label){case 0:return[4,U()];case 1:return n=r.sent().data.calendars,e=Date.now(),[2,M({calendarsUids:n.map((function(t){return t.uid})),from:e,to:(0,O.iX)(e+(0,l.v0)(t))})]}}))}))}}}]);