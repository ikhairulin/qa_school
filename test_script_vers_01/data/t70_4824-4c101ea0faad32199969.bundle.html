"use strict";(self.webpackChunk_mail_octavius=self.webpackChunk_mail_octavius||[]).push([[4824],{44824:function(e,t,r){r.r(t);var n=r(90557),c=r(39783),o=r.n(c),a=r(77917),i=function(e,t,r){if(r||2===arguments.length)for(var n,c=0,o=t.length;c<o;c++)if(n||!(c in t)){if(!n)n=Array.prototype.slice.call(t,0,c);n[c]=t[c]}return e.concat(n||Array.prototype.slice.call(t))},l={checkOnMissingAttach:function(e){if(e.get("source.forward")||e.attachments.length)return Promise.resolve(!1);else return(0,n.HP)().then((function(t){return t.hasAttachment(l.getEnteredText(e.get("body.html")))}))},checkOnRettachToReply:function(e){var t=this,r=e.get("source.reply");if(!r)return Promise.resolve({});var n=e.get("folder_id");return o().findOne({id:r,folder_id:n}).then((function(r){var n=t._hasNewEmails(r,e),c=t._hasAttachToReattach(r);return{hasNewAttach:n&&c,source:r}}))},getEnteredText:function(e){var t=document.createElement("div");return t.innerHTML=e,Array.prototype.forEach.call(t.querySelectorAll((0,a.selector)("blockquote")),(function(e){e.parentNode&&e.parentNode.removeChild(e)})),Array.prototype.forEach.call(t.querySelectorAll((0,a.selector)("br")),(function(e){if(e.parentNode)e.parentNode.insertBefore(document.createTextNode("\n"),e),e.parentNode.removeChild(e)})),t.innerHTML},_hasNewEmails:function(e,t){var r=e.get("correspondents"),n=i(i(i(i([],r.from,!0),r.to,!0),r.cc,!0),r.bcc,!0).map((function(e){return e.email})),c=t.get("correspondents");return i(i(i([],c.to,!0),c.cc,!0),c.bcc,!0).map((function(e){return e.email})).some((function(e){return!n.includes(e)}))},_hasAttachToReattach:function(e){var t=e.get("attaches.list"),r=["text/calendar","application/ics"],n=new RegExp(/.ics$/);return t.some((function(e){return!r.includes(e.get("content_type"))&&!n.test(e.get("name"))}))}};t.default=l}}]);