(self.webpackChunk_mail_octavius=self.webpackChunk_mail_octavius||[]).push([[8907],{35465:function(e,t,n){var r,o;r=[n(18440)],void 0===(o=function(e){return e.smartParse(e.__FEAST_TEMPLATE__`<div></div>
`,"./app/ui-block/drag-and-drop/drag-and-drop.html")}.apply(t,r))||(e.exports=o)},78613:function(e,t,n){"use strict";n.d(t,{Y:function(){return u},q:function(){return l}});var r=n(21211),o=n(62974),a=n(63062),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o];return e}).apply(this,arguments)},c=function(e){var t={count:e};return i18n.plural(e,[i18n("{count} файлов",t),i18n("{count} файл",t),i18n("{count} файла",t)])};function u(e,t,n,u){if(void 0===n)n="";var l,s,d=e.successes,f=e.total,h=e.firstFileName,_=[{text:u?i18n("в {folderName}",{folderName:u}):i18n("в Облако"),link:"".concat(r.CLOUD_HOME_URL).concat(n)}],p=f!==d?"".concat(i18n(" из")," ").concat(f):"",v={text:t?"".concat(c(f)," ").concat((s={count:l=f},i18n.plural(l,[i18n("загружается",s),i18n("загружается",s),i18n("загружаются",s)]))):"".concat(c(d)).concat(p," ").concat(function(e){var t={count:e};return i18n.plural(e,[i18n("загружено",t),i18n("загружен",t),i18n("загружено",t)])}(d)),qa:t?"dnd-cloud-loading":"dnd-cloud-success:".concat(d,":").concat(f)};if(1===f&&h){var m=t?i18n("загружается"):i18n("загружен"),y=m.length+"...".length+1,g=a.default.MAX_LENGTH-y,b=h.length<g?h:"".concat(h.slice(0,g)).concat("...");v={text:"".concat(b," ").concat(m),icon:"ACTIONS_CLOUD_UPLOAD",qa:t?"dnd-cloud-loading":"dnd-cloud-success-one"}}if(v.secondaryActions=[],v.link=n,!t){if(r.DND_CLOUD_SHARE&&(0,o.w)())v.secondaryActions.push({text:i18n("Скопировать ссылку"),event:"copy"});if(r.DND_CLOUD_FOLDER_CHOICE)v.secondaryActions.push({text:i18n("Выбрать папку"),event:"choice"});if(!d)v={text:i18n("Не удалось загрузить файлы"),type:a.default.types.error,qa:"dnd-cloud-all-failed"}}return i({actions:_,duration:t?void 0:r.DND_NOTIFY_DURATION},v)}function l(){return a.default.add({type:a.default.types.error,text:i18n("Что-то пошло не так"),qa:"dnd-cloud-err"})}},4694:function(e,t,n){"use strict";n.d(t,{E:function(){return h},y:function(){return _}});var r,o=n(21211),a=n(62974),i=n(78613),c=n(5339),u=n(78267),l=n(63062),s=n(93286),d=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function c(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))},f=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;if(r=0,o)a=[2&a[0],o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}if(o[2])i.ops.pop();i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};!function(e){e.choice="choice",e.copy="copy"}(r||(r={}));var h=function(e,t){var n=l.default.add(e);return n.on("action:secondary",(function(h){switch(h.details){case r.copy:return function(e,t){c.default.createWebLink(t).then((function(e){return(0,a.Z)(e)})).then((function(){var t=[{text:i18n("Скопировано"),event:null}];if(o.DND_CLOUD_FOLDER_CHOICE)t.push({text:i18n("Выбрать папку"),event:"choice"});e.set({"secondary-actions":t}),(0,s.ZP)("dnd_cld_share")})).catch((function(){e.close(),l.default.error({text:i18n("Не удалось скопировать ссылку")}),(0,s.ZP)("dnd_cld_err-share")}))}(n,e.link);case r.choice:return function(e,t){return d(void 0,void 0,void 0,(function(){var n,r,o;return f(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,c.default.getFoldersTree()];case 1:return n=a.sent(),r=n.map((function(e){return e.name})),null==e||e.close(),[4,u.default.open("choose-save-folder",{tree:r,filesObjects:t},{dimmer:!0,resolvable:!0,"reject-on-close":!0})];case 2:return a.sent(),(0,s.ZP)("cl_ch_fold_resolve"),[3,4];case 3:return o=a.sent(),(0,s.ZP)({type:"cl_ch_fold_err",rlog:"cl_ch_fold_err",rlog_message:o}),(0,i.q)(),[3,4];case 4:return[2]}}))}))}(n,t)}})),n},_=function(e){var t,n,r=e.length,o=e.filter((function(e){return e.status===c.PromiseStatus.fulfilled})),a=o.length,u=r-a,l=(null===(t=o[0])||void 0===t?void 0:t.value)||{},s=l.name,d=l.path,f=void 0===d?"":d,h=null===(n=f.match(/.*\//))||void 0===n?void 0:n[0],_=1===r?f:h;return{notifyParams:(0,i.Y)({successes:a,total:r,firstFileName:s},!1,_),fulfilledFilesObjects:o.map((function(e){var t=e.value;return{path:t.path,name:t.name}})),total:r,successCount:a,fails:u}}},81477:function(e,t,n){"use strict";var r,o=n(21211),a=n(88695),i=n(78267),c=n(93286),u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o];return e}).apply(this,arguments)};!function(e){e.LoadSubmit="LOAD_SUBMIT",e.CancelPayment="CANCEL_PAYMENT"}(r||(r={}));var l=function(e){var t=e.details,n=t.message.type,o=t.layer;if(n===r.LoadSubmit)o.broadcast("layer:resolve"),o.broadcast("layer:hide");if(n===r.CancelPayment)o.broadcast("layer:close")};t.Z=function(e,t){var n=e.reduce((function(e,t){var n=e.total,r=e.max,o=t.get("size");return{max:Math.max(o,r),total:n+o}}),{total:0,max:0}),r=n.total,s=n.max,d=e.length;(0,c.ZP)({type:"compose_oversize-cloud_init",dwh:{totalFileSize:r,maxFileSize:s,filesCount:d}});var f={"close-on-dimmer":!1,"close-on-esc":!1,"hide-headline":!0},h=function(e,t){var n=(0,a.Z)(o.CLOUD_TARIFFS_IFRAME_URL,u({max_size:s,total_size:r,from:e},t&&{afterReload:t}));return i.default.openIframeLayer({paramsKey:"cloud_tariff",additionalParams:{url:n,close:!0},factoryParams:f,onPostMessage:l}).then((function(e){return new Promise((function(t,n){e.on("layer:resolve",(function(){(0,c.ZP)("compose_oversize-cloud_submit"),t()})),e.on("layer:close",n)}))})).catch((function(){return i.default.open("oversize-attach-cancel",{from:e},u(u({},f),{resolvable:!0,"reject-on-close":!0})).then((function(){return h(e,!0)})).catch((function(){return(0,c.ZP)("compose_oversize-cloud_close"),Promise.reject("oversize-attach_close-cloud-tariffs")}))}))};return h(t)}},18907:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Q}});var r,o=n(21528),a=n(19275),i=n(21211),c=n(18440),u=n.n(c),l=n(35465),s=n.n(l),d=n(39939),f=n(50542),h=n(74456),_=n(78267),p=n(93286),v=n(90557),m=n(63062);function y(e){var t=e.dataTransfer,n={files:(null==t?void 0:t.files)||[],items:(null==t?void 0:t.items)||[],types:(null==t?void 0:t.types)||[]};return{type:e.type,target:e.target,dataTransfer:n}}function g(e){var t=e.event,n=e.limit,o=e.isCloudLoad,i=void 0===o?!1:o;return(0,v.bE)().then((function(e){var o,c,u=!!a.Z.get("qa"),l=u?window.DragAndDropTestFiles:e.getFiles(t);if(!l||!l.length||0===l.length){var s=i?i18n("Не удалось загрузить файлы"):i18n("Не удалось прикрепить файл");m.default.add({type:m.default.types.error,text:s}),c=r.NO_FILES}if(l.length>n)c=r.MAX_FILES;var d=u?window.DragAndDropTestFiles:null===(o=t.dataTransfer)||void 0===o?void 0:o.files,f=(null==d?void 0:d.length)||0,h=f-((null==l?void 0:l.length)||0);return(0,p.ZP)({type:"dnd_files-check",dwh:{total:f,filtered:h}}),{files:l,error:c}})).catch((function(e){return{files:[],error:e}}))}!function(e){e.NO_FILES="no files",e.MAX_FILES="more than max",e.OVERSIZE_FILES="oversize files"}(r||(r={}));var b=n(26812),w=n(56220),P=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function c(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))},A=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;if(r=0,o)a=[2&a[0],o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}if(o[2])i.ops.pop();i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};function E(){return P(this,void 0,void 0,(function(){var e,t;return A(this,(function(n){switch(n.label){case 0:return[4,(0,b.t)()];case 1:return(e=n.sent()).set("features.subject_from_attachments",!0),t=(0,w.M9)(d.default.user),e.set("body.html","<div><br/></div><div><br/></div>"+t),[2,{formData:e}]}}))}))}function S(e,t){var n=t.slice(0,e.MAX_ATTACHMENTS_COUNT);f.default.add(e,{isDragAndDrop:!0,dragAndDropItem:{files:n}})}function x(e){return P(this,void 0,void 0,(function(){var t,n,o,a,i,c,u;return A(this,(function(l){switch(l.label){case 0:if(t=y(e),n=_.default.getInstance())n.onHide();l.label=1;case 1:return l.trys.push([1,4,,5]),[4,E()];case 2:return o=l.sent().formData,[4,g({event:t,limit:o.MAX_ATTACHMENTS_COUNT})];case 3:if(a=l.sent(),i=a.files,c=a.error){if(c===r.MAX_FILES)_.default.open("max-attach-count",{onAttachClick:function(){return S(o,i)}},{});return[2]}return S(o,i),(0,p.ZP)("dnd_create_msg_success"),[3,5];case 4:if(u=l.sent(),f.default.onFailSent({},u),u&&u.get)(0,p.ZP)("dnd_create_msg_err",u.status);else(0,h.Z)("trackJS").then((function(e){return e.addErrorFromApp(u,"dnd-create-msg")}));return[3,5];case 5:return[2]}}))}))}var C=n(17717),k=n.n(C),D=n(50),O=n.n(D),Z=function(e){var t=e.map((function(e){return O().from(e)}));return Promise.all(t)},L=function(e){return Z(e).then((function(e){return!!e.find((function(e){return e.isOverMaxLinkSize()&&e.isBlob()}))}))},F=n(78613),T=n(4694),I=n(81477),N=n(5339),M=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function c(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))},U=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;if(r=0,o)a=[2&a[0],o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}if(o[2])i.ops.pop();i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},z="octavius_dnd_over",R=function(e){return M(void 0,void 0,void 0,(function(){var t,n;return U(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,N.default.createFiles(e,i.OVERSIZE_CLOUD_ATTACHES_FOLDER)];case 1:return t=r.sent(),(0,p.ZP)("dnd_cld_over_ok"),[2,t];case 2:return n=r.sent(),(0,p.ZP)({type:"dnd_cld_load_over_err",rlog:z,rlog_message:n}),(0,F.q)(),[3,3];case 3:return[2]}}))}))},q=function(e){return M(void 0,void 0,void 0,(function(){var t,n,r,o,a,i,c,u;return U(this,(function(l){switch(l.label){case 0:(0,p.ZP)("dnd_cld_over_files"),t=null,l.label=1;case 1:return l.trys.push([1,6,,7]),[4,Z(e)];case 2:return n=l.sent(),[4,(0,I.Z)(n,"dnd")];case 3:return l.sent(),r=(0,F.Y)({total:e.length,firstFileName:e[0].name},!0),t=(0,T.E)(r),[4,N.default.isAgreedLA()];case 4:return l.sent(),[4,R(e)];case 5:return o=l.sent(),a=(0,T.y)(o),i=a.notifyParams,c=a.fulfilledFilesObjects,(0,T.E)(i,c),[3,7];case 6:return u=l.sent(),(0,p.ZP)({type:"dnd_cld_over_err",rlog:z,rlog_message:u}),[3,7];case 7:return null==t||t.close(),[2]}}))}))},H=function(e){_.default.open("cloud-license",{},{dimmer:!0,resolvable:!0,"reject-on-close":!0}).then((function(){(0,p.ZP)("dnd_cld_accept_la"),N.default.agreeLa().then((function(){N.default.isAgreedLA().then((function(t){if(!t)(0,p.ZP)("dnd_cld_no_accept"),(0,F.q)();else X(e)}))})).catch((function(e){(0,p.ZP)({type:"dnd_agr_la_err",rlog:"dnd_agr_la_err",rlog_message:e}),(0,F.q)()}))})).catch((function(){(0,p.ZP)("dnd_cld_discard_la")}))};function j(e){g({event:y(e),limit:i.DND_CLOUD_FILES_LIMIT,isCloudLoad:!0}).then((function(e){var t=e.files,n=e.error;switch(n){case r.MAX_FILES:m.default.add({text:i18n("Превышено разрешенное кол-во файлов для загрузки"),qa:"dnd-cloud-max-files"}),(0,p.ZP)("dnd_cld_max_files"),t=t.slice(0,i.DND_CLOUD_FILES_LIMIT);break;case r.NO_FILES:return void(0,p.ZP)("dnd_cld_no_files");default:if(n)return void(0,p.ZP)({type:"dnd_cld_some_err",rlog:"octavius_dnd",rlog_message:n})}return t})).then((function(e){return L(e).then((function(t){if(t)if(i.OVERSIZE_CLOUD_ATTACHES)return q(e);else return m.default.error({text:i18n("Вы не можете загрузить файлы более 2Гб"),qa:"dnd-cloud-over-files"}),void(0,p.ZP)("dnd_cld_over_files");N.default.isAgreedLA().then((function(t){if(!t)H(e);else X(e)})).catch((function(t){var n=t.type,r=t.err;if(n!==N.Errors.ResponseNoAuth)(0,F.q)(),(0,p.ZP)({type:"dnd_cld_".concat(n),rlog:"octavius_dnd",rlog_message:r});else H(e)})),(0,p.ZP)("dnd_cld_load_success")}))}))}function X(e){var t=e.length,n=(0,F.Y)({total:t,firstFileName:e[0].name},!0),r=(0,T.E)(n);N.default.createFiles(e).then((function(e){var t=(0,T.y)(e),n=t.notifyParams,o=t.fulfilledFilesObjects,a=t.total,i=t.successCount,c=t.fails;null==r||r.close(),(0,T.E)(n,o),(0,p.ZP)({type:"dnd_to_cloud_success",dwh:{total:a,successes:i,fails:c}});var u=k().get("octavius-notify-dnd-v2");if(u.getCount("show")>0)(0,p.ZP)("dnd_to_cloud_after_promo_".concat(u.index));if(!i)(0,p.ZP)("dnd_to_cloud_all_fail");if(c)e.filter((function(e){return e.status===N.PromiseStatus.rejected})).forEach((function(e){var t=e.reason;return(0,p.ZP)({type:"dnd_to_cloud_fail",rlog:"octavius_dnd",rlog_message:t})}))})).catch((function(e){null==r||r.close(),(0,F.q)(),(0,p.ZP)({type:"dnd_cld__create_err",rlog:"octavius_dnd",rlog_message:e})}))}var B=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function c(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((r=r.apply(e,t||[])).next())}))},G=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;if(r=0,o)a=[2&a[0],o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}if(o[2])i.ops.pop();i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};function Y(){return B(this,void 0,void 0,(function(){var e,t,n,r,o,a,i;return G(this,(function(c){switch(c.label){case 0:return[4,(0,b.t)()];case 1:if(e=c.sent(),t=d.default.user.attributes.name,n=t.first,r=t.last,o=(0,w.M9)(d.default.user),e.set("body.html","<div><br/></div><div><br/></div>"+o),a=d.default.user.getEmail(),i=n||"",r)i="".concat(i," ").concat(r);return e.set("correspondents.to",[{email:a,name:i||a}]),e.set("features.subject_from_attachments",!0),[2,{formData:e}]}}))}))}function V(e,t){var n=t.slice(0,e.MAX_ATTACHMENTS_COUNT);return L(n).then((function(t){var r=!(i.OVERSIZE_CLOUD_ATTACHES&&t);f.default.add(e,{autosend:r,isDragAndDrop:!0,dragAndDropItem:{files:n}})}))}function J(e){return B(this,void 0,void 0,(function(){var t,n,o,a,i,c,u;return G(this,(function(l){switch(l.label){case 0:if(t=y(e),n=_.default.getInstance())n.onHide();l.label=1;case 1:return l.trys.push([1,4,,5]),[4,Y()];case 2:return o=l.sent().formData,[4,g({event:t,limit:o.MAX_ATTACHMENTS_COUNT})];case 3:if(a=l.sent(),i=a.files,c=a.error){if(c===r.MAX_FILES)_.default.open("max-attach-count",{onAttachClick:function(){return V(o,i)}},{});return[2]}return V(o,i),(0,p.ZP)("dnd_to_yourself_success"),[3,5];case 4:if(u=l.sent(),f.default.onFailSent({},u),u&&u.get)(0,p.ZP)("dnd_send_self_msg_err",u.status);else(0,h.Z)("trackJS").then((function(e){return e.addErrorFromApp(u,"dnd-to-yourself")}));return[3,5];case 5:return[2]}}))}))}var $=n(77917),K=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)if(r||!(o in t)){if(!r)r=Array.prototype.slice.call(t,0,o);r[o]=t[o]}return e.concat(r||Array.prototype.slice.call(t))},Q=u().Block.extend({name:"drag-and-drop",template:s(),_getContainer:function(){return document.querySelector("#drag-and-drop")},attrChanged:{"dark-mode":function(e){if(this.ui)this.ui.$set({darkMode:e})}},didMount:function(){var e=this;Promise.resolve().then((function(){var t=[n(10705)];(function(t){t.default.registerInstanceByName("drag-and-drop",e)}).apply(null,t)})).catch(n.oe),this.renderUI()},didUnmount:function(){this.unrenderUI()},renderUI:function(){var e=this;this.unrenderUI(),n.e(6816).then(n.t.bind(n,26816,23)).then((function(t){var n=t.default;e.ui=n(e.getParams())}))},unrenderUI:function(){var e;null===(e=this.ui)||void 0===e||e.$destroy(),this.ui=null},getParams:function(){var e={"unsafe-markOpen":"<mark>","unsafe-markClose":"</mark>","unsafe-br":"<br>"},t=i18n("Перетащите файлы в эту область,{br}чтобы {markOpen}написать письмо{markClose}",e),n=i18n("Отправить {markOpen}письмо себе{markClose}",e),r=i18n("Загрузить {markOpen}в Облако{markClose}",e),o=this.is("dark-mode"),c=!!a.Z.qa;return{target:this._getContainer(),darkMode:o,isQA:c,zones:[{size:1.5,zones:[{size:1,text:t,radarFunction:function(){return(0,p.ZP)("dnd_drop_create_letter")},iconSize:"large",iconName:"mail",dropFunction:x,testId:"drop-zone-mail"}]},{size:1,zones:K([{size:1,text:n,radarFunction:function(){return(0,p.ZP)("dnd_drop_to_yourself")},iconSize:"small",iconName:"self-mail",dropFunction:J,testId:"drop-zone-self-mail"}],i.DND_CLOUD_ENABLED?[{size:1,text:r,radarFunction:function(){return(0,p.ZP)("dnd_drop_to_cloud")},iconSize:"small",iconName:"cloud",dropFunction:j,testId:"drop-zone-cloud"}]:[],!0)}],showRule:this._getShowRule(),onShow:this.showRadar,imgsBaseUrl:a.Z.urls.packagesUrl,imgsPath:i.DND_IMAGES_PATH}},showRadar:function(){(0,p.ZP)("dnd_show")},_getShowRule:function(){var e=this;if(!o.default.has("drag-and-drop"))return function(){return!1};else return function(){var t,n=_.default.getInstance(),r=0!==document.querySelectorAll((0,$.selector)('[data-test-id="popup-wrapper"]')).length,o=e.get("router").model.route&&e.get("router").model.route.is("#attachment #attachment-temporary #attachment-editor"),a=null===(t=null===window||void 0===window?void 0:window.__PH)||void 0===t?void 0:t.authForm.isVisible();return!(f.default.isComposeActive()||n||r||o||a)}}})}}]);