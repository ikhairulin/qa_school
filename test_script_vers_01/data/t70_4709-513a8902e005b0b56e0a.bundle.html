(self.webpackChunk_mail_octavius=self.webpackChunk_mail_octavius||[]).push([[4709],{94306:function(e,t,o){var n,s;n=[o(18440)],void 0===(s=function(e){return e.smartParse(e.__FEAST_TEMPLATE__`<div qa:id="{(attrs['window-mode'] === 'collapsed') ? '' : 'compose-app'}"
	 qa:state="extended:{attrs['support-extend'] && attrs.extended}"
	 message-uid="{attrs.form.uid}">
	<bem:mod name="fix"/>
	<bem:mod name="fullscreen" test="attrs.fullscreen"/>
	<bem:mod name="mobile" test="attrs.mobile"/>
	<bem:mod name="mobile-xxs" test="attrs['mobile-xxs']"/>
	<bem:mod name="popup" test="!attrs.fullscreen"/>
	<bem:mod name="popup-extended" test="attrs['support-extend'] && attrs.extended"/>
	<bem:mod name="window" test="attrs['window-mode'] === 'window'"/>
	<bem:mod name="collapsed" test="attrs['window-mode'] === 'collapsed' || attrs.hidden"/>
	<bem:mod name="adaptive" test="attrs.adaptive && !attrs.fullscreen"/>
	<bem:mod name="fixed" test="!attrs.adaptive && !attrs.fullscreen"/>

	<b:focus-zone
			fluid
			enabled="{attrs['window-mode'] !== 'collapsed' && !attrs['focusoff'] && !attrs['hidden']}"
			bem:block="compose-app"
			remit:first="focus-zone:first"
			remit:last="focus-zone:last">
		<fn:match name="content">
			<!--<div bem:elem="wrapper" ref="wrapper">-->
				<div
						bem:elem="compose"
						ref="compose"
				>
					<!-- COMPOSE.MAIL.RU -->
				</div>
		</fn:match>
	</b:focus-zone>
</div>
`,"./app/ui-block/compose-app/compose-app.html")}.apply(t,n))||(e.exports=s)},28633:function(e,t,o){var n,s;n=[o(18440)],void 0===(s=function(e){return e.smartParse(e.__FEAST_TEMPLATE__`<div>
	<bem:mod name="fluid" test="attrs.fluid"/>

	<fn:apply-match name="content"/>
</div>
`,"./app/ui-block/focus-zone/focus-zone.html")}.apply(t,n))||(e.exports=s)},56969:function(e,t,o){"use strict";var n=o(18440),s=o.n(n),i=o(28633),a=o.n(i),r=o(77917);t.Z=s().Block.extend({name:"focus-zone",template:a(),isolateEvents:!1,blocks:{},defaults:{enabled:!0,fluid:!1},attrChanged:{enabled(e){this.toggleListener(e)}},didUnmount(){this.toggleListener(!1)},toggleListener(e){this[e?"$on":"$off"](this.el.ownerDocument.defaultView,"keydown","onKeyDown")},onKeyDown(e){if(9===e.keyCode){e.preventDefault();var t=e.shiftKey,o=this.queryFocusableElements(),n=document.activeElement,s=o.indexOf(n);if(-1===s)s=0;if(t&&s<=0)s=o.length;else if(!t&&s>=o.length-1)s=-1;var i=o[s+(t?-1:1)];i&&i.focus&&i.focus()}},queryFocusableElements(){var e=[...this.el.querySelectorAll((0,r.selector)("[tabindex]"))].filter(e=>e.tabIndex>0);return e.sort((e,t)=>e.tabIndex>t.tabIndex?1:-1),e}})},45623:function(e,t,o){var n;void 0===(n=function(e){"use strict";var t=o(57123),n=o(66423),s=t.extend({operation:function(e){switch(e.method){case s.UPDATE:return this._update(e.data);case s.REMOVE:return this._remove(e.data);default:throw new Error("Действие не найдено",e.method)}},_update:function(e){return n.post("messages/schedule/update",e)},_remove:function(e){return n.post("messages/schedule/remove",e)}});return s.UPDATE="UPDATE",s.REMOVE="REMOVE",t.register("mail.Schedule",s),s.version="0.2.0",s}.call(t,o,t,e))||(e.exports=n)},81477:function(e,t,o){"use strict";var n,s=o(21211),i=o(88695),a=o(78267),r=o(93286),l=function(){return(l=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var s in t=arguments[o])if(Object.prototype.hasOwnProperty.call(t,s))e[s]=t[s];return e}).apply(this,arguments)};!function(e){e.LoadSubmit="LOAD_SUBMIT",e.CancelPayment="CANCEL_PAYMENT"}(n||(n={}));var c=function(e){var t=e.details,o=t.message.type,s=t.layer;if(o===n.LoadSubmit)s.broadcast("layer:resolve"),s.broadcast("layer:hide");if(o===n.CancelPayment)s.broadcast("layer:close")};t.Z=function(e,t){var o=e.reduce((function(e,t){var o=e.total,n=e.max,s=t.get("size");return{max:Math.max(s,n),total:o+s}}),{total:0,max:0}),n=o.total,d=o.max,u=e.length;(0,r.ZP)({type:"compose_oversize-cloud_init",dwh:{totalFileSize:n,maxFileSize:d,filesCount:u}});var h={"close-on-dimmer":!1,"close-on-esc":!1,"hide-headline":!0},m=function(e,t){var o=(0,i.Z)(s.CLOUD_TARIFFS_IFRAME_URL,l({max_size:d,total_size:n,from:e},t&&{afterReload:t}));return a.default.openIframeLayer({paramsKey:"cloud_tariff",additionalParams:{url:o,close:!0},factoryParams:h,onPostMessage:c}).then((function(e){return new Promise((function(t,o){e.on("layer:resolve",(function(){(0,r.ZP)("compose_oversize-cloud_submit"),t()})),e.on("layer:close",o)}))})).catch((function(){return a.default.open("oversize-attach-cancel",{from:e},l(l({},h),{resolvable:!0,"reject-on-close":!0})).then((function(){return m(e,!0)})).catch((function(){return(0,r.ZP)("compose_oversize-cloud_close"),Promise.reject("oversize-attach_close-cloud-tariffs")}))}))};return m(t)}},84709:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return Le}});var n=o(51955),s=o(21528),i=o(17717),a=o.n(i),r=o(10261),l=o(66423),c=o.n(l),d=function(e,t,o,n){return new(o||(o=Promise))((function(s,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function r(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))},u=function(e,t){var o,n,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(s=2&i[0]?n.return:i[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,i[1])).done)return s;if(n=0,s)i=[2&i[0],s.value];switch(i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}if(s[2])a.ops.pop();a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}},h="filters/autoreply";function m(e){var t=e.emails,o=e.only_enabled,n=void 0===o?!0:o;if(!t)return Promise.reject({emails:"required"});if(!Array.isArray(t))return Promise.reject({emails:"invalid"});else return c().call(h,{emails:t,only_enabled:n})}var f=(0,r.createGlobalAction)(h,(function(e){return d(void 0,void 0,Promise,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,m(e)];case 1:return[2,t.sent().body]}}))}))})),_=o(13620),p=o(43055),T=o(19275),E=o(36822),C=o.n(E),S=o(21211),A=o(89629),O=o.n(A),v=o(18440),g=o.n(v),b=o(26499),L=o(91779),I=o(44438),R=o(94306),M=o.n(R),D=o(54844);var N=o(83183),P=o(81477),y=o(72727),F=function(){var e=document.createElement("div");e.style.overflowY="scroll",e.style.msOverflowStyle="scrollbar",e.style.width="50px",e.style.height="50px",e.style.visibility="hidden",document.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t}(),U=o(56220);function x(e){for(var t=e.length,o=0,n=0,s=0;s<t;){var i=e.charCodeAt(s++);if(!(i>1040&&i<1103)){if(!(i>0&&i<64)){if(55296==(63488&i)&&s<t){if(56320==(64512&e.charCodeAt(s++)))continue}n++}}else o++,n++}return 100*o/n>S.LETTER_CYRILLIC_PERCENT}var B=o(90557),w=o(96596),k=o.n(w),H=o(18199),K=o.n(H),Z=o(45623),G=o.n(Z),V=o(71774),W=o.n(V),z=o(50),Y=o.n(z),q=o(85054),j=o.n(q),J=o(4872),X=o.n(J),Q=o(39783),$=o.n(Q),ee=o(68524),te=o.n(ee),oe=o(7414),ne=o.n(oe),se=o(39939),ie=o(85271),ae=o(5339),re=o(50542),le=o(53785),ce=o(57579),de=o(74456),ue=o(82921),he=o(78267),me=o(50375),fe=o(63062),_e=o(61799),pe=o(93286),Te=o(77917),Ee=o(57045),Ce=o(8387),Se={LABEL_TO:-1,LABEL_CC:-1,LABEL_BCC:-1,INPUT_ATTACH_FILE:-1,INPUT_TO:100,INPUT_CC:200,INPUT_BCC:300,INPUT_SUBJECT:400,BUTTON_ATTACH_FILE:500,EDITOR:505,EDITOR_ADDLINK_HREF:510,EDITOR_ADDLINK_TEXT:515,EDITOR_ADDLINK_SAVE:520,EDITOR_ADDLINK_CANCEL:525,EDITOR_ADDLINK_DELETE:530,INSERT_TABLE_ROWS:560,INSERT_TABLE_COLUMNS:561,INSERT_TABLE_SUBMIT:562,BUTTON_SEND:570,BUTTON_SAVE:580,BUTTON_CANCEL:590,BUTTON_COLLAPSE:600,BUTTON_EXTEND:650,BUTTON_CLOSE:700,HEAD_CONTROL_FROM:710,HEAD_CONTROL_CC:720,HEAD_CONTROL_BCC:730,BUTTON_CLOSE_CC:900,BUTTON_CLOSE_BCC:1100,BUTTON_MONEY_SEND:1300,BUTTON_ATTACH_CLOUD:1400,BUTTON_ATTACH_MAIL:1500,DROPDOWN_TEMPLATES:1600},Ae=o(96130),Oe=o(45114),ve=o(56969),ge=o(51474),be=function(){return(be=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var s in t=arguments[o])if(Object.prototype.hasOwnProperty.call(t,s))e[s]=t[s];return e}).apply(this,arguments)},Le=g().Block.extend((0,_e.Z)({events:[{name:"send",rename:function(e){return e.is("schedule")?"send_scheduled":"send"},data:function(e){return e.get("form")}},{name:"collapse"},{name:"mount",data:function(e){return e.get("form")}},{name:"close",data:function(e){return e.get("form")}}],explicit:!0})({name:"compose-app",template:M(),isolateEvents:!1,performanceTrace:!0,mods:{letterHours:I.Xr},blocks:{button2:Oe.Z,"button-link":Ae.Z,"focus-zone":ve.Z,"react-async":ge.Z},notVisualAttributes:{closing:!0},defaults:{focusoff:!1,form:null,"send-delay":0,"has-changes":!1,"draft-on-close-enabled":!0,"draft-timeout":S.AUTOSAVE_DRAFT_TIMEOUT_SECONDS,"template-enabled":!1,saving:!1,sending:!1,fullscreen:!1,mobile:S.TOUCH_MODE,ponymode:!1,adaptive:!1,hidden:!1,"expand-status":!1,closing:!1,"translate-mode":!1,darkMode:!1,extended:!1,"support-extend":!0,autosend:!1,"is-drag-and-drop":!1,"drag-and-drop-item":null,errors:null,receipt:!1,priority:3,schedule:!1,scheduleDate:new Date,collectors:[],aliases:[]},events:{send:"onSend",save:"_updateComposeFields",shortcut:"onShortcut","nav:draft":"onNavDraft","nav:template":"onNavTemplate","focus-zone:first":"onRequestFirstFocus","focus-zone:last":"onRequestLastFocus","translation:use":"onTranslationSave","translation:cancel":"onTranslationCancel","translation:retry":"onTranslationRetry","first-render":"onFirstRender"},attrChanged:{errors:function(e){this.errors=e,this.composeRender()},priority:function(e){this.get("form").set("priority",e),this.set("has-changes",!0)},receipt:function(e){this.get("form").set("receipt",e),this.set("has-changes",!0)},sending:function(e,t){if(e!==t&&!e)this.get("form").set("finalized",!1);this.composeRender()},ponymode:function(){this.composeRender()},darkMode:function(){this.composeRender()},extended:function(){this.composeRender()},"mobile-xxs":function(){this.composeRender()},"support-extend":function(){this.composeRender()},"expand-status":function(){this._updateComposeVisuals()},"window-mode":function(){this.composeRender()},hidden:function(e){if(!e)this._setupFocus()},sendDate:function(e){if(e)this.set({schedule:e,scheduleDate:new Date(1e3*e)});this.composeRender()},schedule:function(e){var t=this.get("form");if(e)t.set("send_date",(this.get("scheduleDate").getTime()+"").slice(0,-3));else t.set("send_date","");this.composeRender(),this.set("has-changes",!0)},scheduleDate:function(e){var t=this;Promise.all([o.e(5217),o.e(9308),o.e(7604),o.e(1438),o.e(2708)]).then(o.bind(o,26235)).then((function(o){if(t.isMounted()){var n=o.default,s=t.get("form");if(t.get("schedule"))s.set("send_date",(e.getTime()+"").slice(0,-3)),t.set("scheduleText",n.getFullMomentFormat(e));t.set("has-changes",!0),t.composeRender()}}))},remind:function(e){this.get("form").set("remind",e),this.set("has-changes",!0)},"draft-on-close-enabled":function(e){this.setAutosaveOnClose(e)}},tabIndexes:Se,constructor:function(e,t){g().Block.call(this,e,t),this.onWindowUnload=this.onWindowUnload.bind(this),this.composeRender=this.composeRender.bind(this),this._updateComposeVisuals=this._updateComposeVisuals.bind(this),this._setupFocus=this._setupFocus.bind(this),this._changeTranslateMode=this._changeTranslateMode.bind(this),this.emitter=new(O()),this.emitter.on("translate-mode",this._changeTranslateMode),this.emitter.on("translation-error",this.onTranslationError.bind(this)),this.emitter.on("translation-ok",this.onTranslationOk.bind(this))},didMount:function(){(0,pe.ZP)("on_route_compose"),this.composeRender()},composeRender:function(){var e=this,t=this.get("compose-options"),i=this.get("form"),r=se.default.user.get("signs"),l=se.default.user.getEmail(),d=se.default.user.get("name"),u="".concat(d.first," ").concat(d.last);if(S.LOG_EMPTY_COLLECTORS&&!this.get("collectors"))ne().send("empty-cltrs-compose",{rlog:"empty-collectors",rlog_message:{collectors:typeof this.get("collectors"),place:"composeRender"}});var h=(this.get("collectors")||[]).filter((function(e){return e.canSendLetters()})),m=this.get("aliases"),E=this.is("support-extend")?this.onExtend.bind(this):null;this.onClose=this.onClose.bind(this),this.onCollapse=this.onCollapse.bind(this),this.sendLetter=this.sendLetter.bind(this),this.onReadyToSave=this.onReadyToSave.bind(this),this.onFilesFromCloud=this.onFilesFromCloud.bind(this),this.onFilesFromMail=this.onFilesFromMail.bind(this),this.onCallsInvite=this.onCallsInvite.bind(this),this.onCallTo=this.onCallTo.bind(this),this.onContactsFromMail=this.onContactsFromMail.bind(this),this.openAddressbook=this.openAddressbook.bind(this),this.onSignatureFromMail=this.onSignatureFromMail.bind(this),this.onTemplateSelect=this.onTemplateSelect.bind(this),this.onSaveAsTemplate=this.onSaveAsTemplate.bind(this),this.onExceedMaxSize=this.onExceedMaxSize.bind(this),this.onComposeCreateTo=this.onComposeCreateTo.bind(this),this.onSearchFrom=this.onSearchFrom.bind(this),this.onContactAdd=this.onContactAdd.bind(this),this.onOpenAddressbook=this.onOpenAddressbook.bind(this),this.updateMailboxQuotas=this.updateMailboxQuotas.bind(this),this.lastSeenUpdate=this.lastSeenUpdate.bind(this),this.onSend=this.onSend.bind(this),this.onTranslationSave=this.onTranslationSave.bind(this),this.onTranslationCancel=this.onTranslationCancel.bind(this),this.onChangePriority=this.onChangePriority.bind(this),this.onChangeReceipt=this.onChangeReceipt.bind(this),this.onClickRemind=this.onClickRemind.bind(this),this.onChangeRemind=this.onChangeRemind.bind(this),this.onClickSchedule=this.onClickSchedule.bind(this),this.onChangeSchedule=this.onChangeSchedule.bind(this),this.onTranslationRetry=this.onTranslationRetry.bind(this),Promise.all([(0,B.bE)(),(0,B.Zz)(),re.default.preload(),Promise.all([o.e(5217),o.e(9308),o.e(7604),o.e(1438),o.e(2708)]).then(o.bind(o,26235))]).then((function(o){var d=o[0],A=o[1],O=o[2].ui,v=o[3].default.PromtAboutAdWrapper;if(e.isMounted()){var g=h.concat(m);e.compose=new O.default(e.refs.compose),e.compose.injectDependencies(be(be({Attachment:Y(),cloud:ae.default,Alias:W(),Collector:j(),CloudEntry:C(),Message:$(),MessageFormData:te(),FileAPI:d,RPC:c(),ContactSuggests:K(),checkContactsPossessing:_.l,Phishing:ce.Z},S.PROMT_LOGO_WITH_AD_DROPDOWN&&{PromtAboutAdWrapper:v}),{Clipboard:A,TabIndex:Se,browser:D.Z,features:{CKE_ENABLE_TAB:S.CKE_ENABLE_TAB,CKE_DEFAULT_STYLES:S.CKE_DEFAULT_STYLES,CKE_ATTACH_BASE64:S.CKE_ATTACH_BASE64,CKE_CLIPBOARD_FIX:S.CKE_CLIPBOARD_FIX,CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED:S.CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED,CKE_AUTOCORRECT_ALPHABET_LIST:S.CKE_AUTOCORRECT_ALPHABET_LIST,CKE_QUOTE_PARSE_FIX_DISABLE:S.CKE_QUOTE_PARSE_FIX_DISABLE,COMPOSE_EMOJI:S.COMPOSE_EMOJI,COMPOSE_EMOJI_FILTER:S.COMPOSE_EMOJI_FILTER,COMPOSE_EMOJI_RECENTLY_COUNT:S.COMPOSE_EMOJI_RECENTLY_COUNT,COMPOSE_SLIDER_LAST_STEP_DELTA:S.COMPOSE_SLIDER_LAST_STEP_DELTA,COMPOSE_TRANSLATOR:S.COMPOSE_TRANSLATOR,COMPOSE_ENABLE_TABLES:S.COMPOSE_ENABLE_TABLES,CORRESPONDENTS_LIMIT:S.CORRESPONDENTS_LIMIT,DISABLE_CALLS_COMPOSE_TIP:S.DISABLE_CALLS_COMPOSE_TIP,DISABLE_CLOUD:S.COMPOSE_DISABLE_CLOUD_ATTACHES,DISABLE_FROM_MAIL_ATTACHES:S.DISABLE_FROM_MAIL_ATTACHES,EMOJI_FALLBACK:S.EMOJI_FALLBACK,ENABLE_WYSIWYG_STICKY:S.ENABLE_WYSIWYG_STICKY,EXPIRED_ATTACHES_TOOLTIP:S.EXPIRED_ATTACHES_TOOLTIP,LETTER_TO_YOURSELF:S.LETTER_TO_YOURSELF,TRANSLATOR_REQUEST_TIMEOUT:S.TRANSLATOR_REQUEST_TIMEOUT,MAX_CLOUD_STOCK_SIZE_LIMIT:S.MAX_CLOUD_STOCK_SIZE_LIMIT,OVERSIZE_CLOUD_ATTACHES:S.OVERSIZE_CLOUD_ATTACHES,OVERSIZE_CLOUD_ATTACHES_FOLDER:S.OVERSIZE_CLOUD_ATTACHES_FOLDER,VK:S.VK,MESSAGES_ATTACHES_BLOBCLOUD:S.MESSAGES_ATTACHES_BLOBCLOUD,MESSAGES_ATTACHES_BLOBCLOUD_PATH:S.MESSAGES_ATTACHES_BLOBCLOUD_PATH,LASTSEEN_ONLINE_STATUS:S.LASTSEEN_ONLINE_STATUS,TOUCH_MODE:S.TOUCH_MODE,COMPOSE_FETCH_AUTOREPLY:S.COMPOSE_FETCH_AUTOREPLY,ENABLE_MENTIONS:S.ENABLE_MENTIONS,MENTIONS_MARK:S.MENTIONS_MARK,WEBVIEW:S.WEBVIEW,WEBVIEW_MOBILE_MODE_ENABLED:S.WEBVIEW_MOBILE_MODE_ENABLED,B2B_INNER_ATTACHMENTS_NOTIFY:S.B2B_INNER_ATTACHMENTS_NOTIFY,FAKE_BUTTON_TYPE:S.FAKE_BUTTON_TYPE,FAKE_NOTE_IN_CONTACTS:S.FAKE_NOTE_IN_CONTACTS,FAKE_BUTTON_DISCUSS_DOCUMENT:S.FAKE_BUTTON_DISCUSS_DOCUMENT,FAKE_BUTTON_SIGNING:S.FAKE_BUTTON_SIGNING,FAKE_GOS_TEMPLATE_SUGGESTION:S.FAKE_GOS_TEMPLATE_SUGGESTION,CREATE_NOTE_FROM_COMPOSE:S.CREATE_NOTE_FROM_COMPOSE,NOTES_URL:S.NOTES_URL},ContactValidation:n,radar:(0,pe.$V)({prefix:"cmps",data:i}),onError:function(e,t){(0,de.Z)("trackJS").then((function(o){return o.addErrorFromApp(e,t?"cmps_".concat(t):"cmps_internal_caught")}))},logger:k(),scrollbarWidth:F,Storage:Ee.ZP,mods:{fileSize:L.j,fileSizeRange:L.M,fileCount:b.O,letterAttachLinkDate:I.FE},flags:a(),emojiParser:le.Z}));var R=s.default.get("isNativeStickyDisabled"),M=s.default.get("compose-expand-contacts"),N=e.get("router");if(e.compose.render({signatures:r,fromOptions:g,defaultEmail:l,userName:u,model:i,scrollTarget:e.refs.compose,templatesFetch:e.templatesFetch,lastSeenUpdate:e.lastSeenUpdate,onFilesFromCloud:e.onFilesFromCloud,onFilesFromMail:e.onFilesFromMail,onCallsInvite:S.CALLS&&!S.CALLS_DISABLE_COMPOSE_BTN?e.onCallsInvite:null,onCallTo:S.CALLS?e.onCallTo:void 0,onContactsFromMail:e.onContactsFromMail,onSignatureFromMail:e.onSignatureFromMail,onReadyToSave:e.onReadyToSave,onClose:e.onClose,onExtend:E,fetchAutoreply:f,fetchLastSeen:p.v,onComposeCreateTo:e.onComposeCreateTo,onSearchFrom:e.onSearchFrom,onTemplateSelect:e.onTemplateSelect,onSaveAsTemplate:e.onSaveAsTemplate,onExceedMaxSize:e.onExceedMaxSize,onCollapse:e.onCollapse,onContactAdd:e.onContactAdd,onOpenAddressbook:e.onOpenAddressbook,onOversizeAttachAdd:P.Z,onAttachmentClick:function(e){var t,o;if(!S.DISABLE_COMPOSE_ATTACHMENT_CLICK){var n=(null===(o=null===(t=e.getExtension)||void 0===t?void 0:t.call(e))||void 0===o?void 0:o.toLowerCase())||"",s=e.isCloudStock()&&!S.VIEWER_ATTACH_TEMP_CLOUDSTOCK.includes(n),a=e.isCloud()&&!S.VIEWER_ATTACH_TEMP_CLOUD.includes(n);if(!s&&!a)Ce.Z.openTemporary({messageId:i.uid,formData:i,router:N,attachment:e})}},updateMailboxQuotas:e.updateMailboxQuotas,isNativeStickyDisabled:R&&R.state,isNativeAttachThumbRotation:S.IS_COMPOSE_NATIVE_ATTACH_THUMB_ROTATION,isAllVisibleContactsFeature:M&&M.state,onChangeErrors:e.onChangeErrors,sendLetter:e.sendLetter,errors:e.errors||null,disableInterface:"collapsed"===e.get("window-mode")?!0:e.get("sending"),eventEmitter:e.emitter,darkMode:e.get("darkMode"),extended:e.get("extended"),compressedMode:e.get("ponymode")&&!e.get("mobile-xxs"),isTouch:e.get("mobile"),mobilePhoneLayout:e.get("mobile-xxs"),qaParams:{enabled:T.Z.get("qa")},additionalOptions:t,utils:{isCyrillic:x},schedule:e.get("schedule"),scheduleText:e.get("scheduleText"),onSend:e.onSend.bind(e),onSave:e.onClickSave.bind(e),onTranslationUse:e.onTranslationSave,onTranslationCancel:e.onTranslationCancel,onChangePriority:e.onChangePriority,onChangeReceipt:e.onChangeReceipt,onClickRemind:e.onClickRemind,onChangeRemind:e.onChangeRemind,onClickSchedule:e.onClickSchedule,onChangeSchedule:e.onChangeSchedule,onTranslationRetry:e.onTranslationRetry,onFooterChooseTemplateClick:e.onFooterChooseTemplateClick.bind(e),onCreateNoteFromLetter:e.onCreateNoteFromLetter.bind(e),translationHref:e.getPromtLogoHref(),avatarBaseUrl:T.Z.get("urls.avatarUrl"),quotasEnabled:se.default.user.get("common_purpose_flags.enabled_mbox_quotas"),hideAvatar:S.COMPOSE_HIDE_AVATAR&&e.get("mobile-xxs"),unclickableLabels:S.COMPOSE_DISABLE_CLICKABLE_LABELS&&e.get("mobile-xxs"),hideToolbar:S.COMPOSE_DISABLE_TOOLBAR&&e.get("mobile-xxs"),shortAttachPanel:S.COMPOSE_SHORT_ATTACH_PANEL&&e.get("mobile-xxs"),hideChangeSignature:S.HIDE_CHANGE_SIGNATURE&&e.get("mobile-xxs"),hideCancelButton:S.HIDE_COMPOSE_CANCEL_BUTTON&&e.get("mobile-xxs"),hideWidgets:S.HIDE_COMPOSE_WIDGETS&&e.get("mobile-xxs"),footerDropdown:S.COMPOSE_FOOTER_DROPDOWN&&e.get("mobile-xxs")}),!e.hasRendered)e.broadcast("first-render"),e.hasRendered=!0}}))},onFirstRender:function(){var e=this;if(this.get("is-drag-and-drop")){var t=this.get("drag-and-drop-item");if(t){var o=t.files;if(this.compose.appComponent)this.compose.appComponent.addFilesToModel(o).then((function(t){if(e.get("autosend"))e.broadcast("send");e.compose.appComponent.uploadFiles(t)})).catch((function(t){e.radar("dnd_err_".concat(t))}))}}},onContactAdd:function(e){e.scope="compose-notify",this.broadcast("addressbook:addcontact",e)},onOpenAddressbook:function(e){this.openAddressbook({"free-space":!1,composeMode:!1,openEmail:e.email},!0)},onChangeErrors:function(e){this.errors=e},onSend:function(){var e=this.get("form");if(this._updateComposeFields(),e.set("body.html",(0,U.Gj)(e.get("body.html")),{silent:!0}),this.get("autosend")?!0:this.compose.appComponent.checkSend())this.sendLetter()},lastSeenUpdate:function(e){if(!S.LAST_SEEN_V2_ENABLE)return null;var t=this.get("getLastSeen");ne().send("lastseen-v2-compose",{skipdwh:!0});var o=S.LASTSEEN_COMPOSE_ALLOW_GARAGE;return t(e,{allowUseGarage:o}).then((function(t){var o=t.payload,n=e.map((function(e){var t=o[e];return(0,ue.Z)(t).then((function(t){return{email:e,lastSeen:t}}))}));return Promise.all(n)}))},sendLetter:function(){if(this.get("schedule"))this.broadcast("letter-schedule",{composeApp:this,scheduleText:this.get("scheduleText")});else this.broadcast("letter-send")},templatesFetch:function(){return me.default.load({folder:X().TEMPLATES,limit:25}).catch((function(){return{threads:[]}})).then((function(e){return e.threads.map((function(e){var t=e.subject||e.snippet;return{data:{folder:e.folder,id:e.expand,value:t.trim()?t:"<".concat(i18n("Без темы"),">")}}}))}))},onTemplateSelect:function(e){var t=this,o=e.id,n=e.folder,s=this.get("form");s.fetchTemplate({id:o,folder:n,remove_emoji_opts:N.Y}).then((function(e){if(s.is("source.reply")||s.is("source.forward")){var o=s.mergeTemplate(e,{attachments:!0});t.compose.applyTemplate(o)}else t.broadcast("close",Object.assign(t,{noAnimate:!0})),re.default.open({mode:"template",model:e})}))},didUnmount:function(){this.setAutosaveInterval(!1),this.setAutosaveOnClose(!1);try{this.compose.unmount()}catch(e){if(S.IS_DEBUG)console.error(e);(0,pe.ZP)({type:"compose_unmount_error",rlog:"octavius_jserror",rlog_message:JSON.stringify(e)})}},removeScheduleFromDatalist:function(e){var t=this.get("router");t.model.letters.filter((function(t){return t.getFolder().isOutbox()&&t.get("last")===e})).forEach((function(e){t.model.letters.remove(e)}))},removeSchedule:function(){var e=this,t=this.get("form"),o=t.get("source.schedule"),n=t.get("source.draft"),s={id:o};if(n)s.source={draft:n};G().execute({method:G().REMOVE,data:s}).then((function(){t.set("source.schedule",""),t.set("source.draft",o),e.radar("remove_schedule"),e.removeScheduleFromDatalist(o)})).catch((function(){e.radar("remove_schedule_error")}))},onClickSave:function(){this._updateComposeFields(),this.broadcast("letter-save")},onCreateNoteFromLetter:function(){this._updateComposeFields(),this.broadcast("create-note-from-letter")},onClickSchedule:function(e){var t=!this.get("schedule"),o=new Date(e);if(!t)o=new Date;if(this.set({schedule:t,scheduleDate:o}),!t)this.removeSchedule();this.composeRender()},onChangeSchedule:function(e){this.set({schedule:!0,scheduleDate:new Date(e)})},onChangePriority:function(){this.set({priority:3===this.get("priority")?1:3})},onChangeReceipt:function(){this.set({receipt:!this.get("receipt")})},onClickRemind:function(e){var t=!!this.get("remind");this.set({remind:t?"":e})},onChangeRemind:function(e){this.set({remind:e})},onRequestFirstFocus:function(){var e=this.el.querySelector((0,Te.selector)('[tabindex="'.concat(Se.INPUT_SUBJECT,'"]')));e&&e.focus()},onRequestLastFocus:function(){var e=this.el.querySelector((0,Te.selector)('[tabindex="'.concat(Se.BUTTON_ATTACH_CLOUD,'"]')));e&&e.focus()},layerSingleton:function(e,t,o,n,s){var i=this;if(!this.activeLayer)this.activeLayer=new Promise((function(a,r){e.then((function(){if(!i.isMounted())return i.activeLayer=null,void a();i.set("hidden",!0),he.default.open(t,o,{dimmer:!1,resolvable:!0}).then((function(e){if(i.isMounted())i.set("hidden",!1);return e})).then((function(e){if(s)return s(e);else return Promise.resolve(e)})).then((function(e){return a(e)})).catch((function(e){if(n(e),i.isMounted())i.set("hidden",!1);if(S.IS_DEBUG)console.error(e);return i.activeLayer=null,r(e),Promise.reject(e)})).then((function(){i.activeLayer=null}))}),r)}));return this.activeLayer},onFilesFromCloud:function(e){var t=e.attachments,n=e.selectLimit,s=e.freeSpace;return(0,pe.ZP)("compose_cloud_click"),this.layerSingleton(Promise.all([o.e(4131),o.e(1937),o.e(2464),o.e(2106),o.e(6157)]).then(o.bind(o,86157)),"explorer-from-cloud",{attachments:t,"select-limit":n,"free-space":s},(function(){return(0,pe.ZP)("explorer-cloud_error")}))},onFooterChooseTemplateClick:function(){var e={fetchTemplates:this.templatesFetch,onChoose:this.onTemplateSelect};o.e(4794).then((function(){var t=[o(14794)];(function(){he.default.open("compose-template-select",e,{dimmer:!1,resolvable:!0,mobile:!0})}).apply(null,t)})).catch(o.oe)},onContactsFromMail:function(e){var t=e.contacts,o=e.selectLimit,n=e.freeSpace;(0,pe.ZP)("compose_contacts-search_click");return this.openAddressbook({contacts:t,"select-limit":o,"free-space":n,composeMode:!0},!0)},openAddressbook:function(e){return this.layerSingleton(o.e(6195).then(o.bind(o,56195)),"addressbook",be(be({},e),{router:this.get("router")}),(function(){return(0,pe.ZP)("new-addressbook-layer_error")}))},onFilesFromMail:function(e){var t=e.attachments,n=e.selectLimit,s=e.freeSpace;return(0,pe.ZP)("compose_filesearch_click"),this.layerSingleton(Promise.all([o.e(4131),o.e(1937),o.e(2464),o.e(2106),o.e(3386)]).then(o.bind(o,23386)),"explorer-from-filesearch",{attachments:t,"select-limit":n,"free-space":s},(function(){return(0,pe.ZP)("explorer-files_error")}))},onCallTo:function(e){ie.Z.getCallsAPIClient().callTo([e]).then((function(e){if(e.redirectUrl)(0,y.default)(e.redirectUrl)})).catch((function(e){k().add("onCallTo_compose_error",e),(0,pe.ZP)({type:"onCallTo_compose_error",rlog:"onCallTo_compose_error",rlog_message:e})}))},onCallsInvite:function(){return new Promise((function(e){ie.Z.createRoom().then((function(t){var o=ie.Z.getTemplate(t);e(o)})).catch((function(){fe.default.error({text:i18n("Не удалось создать ссылку на звонок")},"compose-notify")}))}))},onSignatureFromMail:function(){(0,pe.ZP)("compose_sign-edit_click"),(0,y.default)(S.SIGNATURE_URL)},onWindowUnload:function(e){if(this.is("has-changes")||this.isUploadingAttachments()){var t=i18n("Текст письма будет потерян."),o=Date.now();return setTimeout((function(){var e=Date.now()-o;if(e<100)ne()("compose_unload_confirm_disabled&v=".concat(e),{immediately:!0}),k().add("compose_unload_confirm_disabled",{unloadConfirmDuration:e})}),0),(0,pe.ZP)("compose_try_leave_with_unsaved"),k().add("try to leave compose with unsaved changes"),e.returnValue=t,t}},onClose:function(){if(this.set("closing",!0),this.is("translate-mode"))this.broadcast("save");this.broadcast("close")},onExtend:function(){this.broadcast("extend")},onCollapse:function(){this._updateComposeFields(),this.broadcast("collapse")},_updateComposeFields:function(){this.compose.updateFields()},_updateComposeVisuals:function(){if(this.compose)this.compose.updateVisuals()},_setupFocus:function(){if(this.compose)this.compose.setupFocus()},onSaveAsTemplate:function(){var e=this;return this._updateComposeFields(),new Promise((function(t){e.broadcast("savetemplate",{composeApp:e,resolve:t})}))},onExceedMaxSize:function(){this.broadcast("exceedmaxsize")},onAutoSave:function(){if(this.isMounted()){if(!this.get("saving"))this._updateComposeFields(),this.broadcast("autosave")}else this.setAutosaveInterval(!1)},onReadyToSave:function(){this.set("has-changes",!0),this.setAutosaveInterval(!0)},onShortcut:function(e){var t,o=!1,n=e.originalEvent,s=n.metaKey||n.ctrlKey;if(s&&13==n.keyCode)(0,pe.ZP)("compose_action_send_shortcut"),this.broadcast("send");if(s&&"s"===(t=n.keyCode,String.fromCharCode(t).toLowerCase()))(0,pe.ZP)("compose_action_save_shortcut"),this.broadcast("save"),o=!0;return o&&n.preventDefault(),!!o},onNavDraft:function(){this.broadcast("collapse"),this.get("router").go("#letters",{folder:X().DRAFTS})},onNavTemplate:function(){this.broadcast("collapse"),this.get("router").go("#letters",{folder:X().TEMPLATES})},onTranslationOk:function(){this.get("form").set({"translation-error":null,"translation-first-ok":!0})},onTranslationError:function(e){var t="some-error";if(e.status===Number(c().statuses.many_requests))t="many-requests";var o=this.showTranslationNotify("error");this.emitter.one("translation-ok",(function(){null==o||o.close()})),this.get("form").set("translation-error",t)},onTranslationCancel:function(){this.compose.disableTranslate(!1),this.get("form").clearTranslation()},onTranslationSave:function(){var e=this;this.compose.disableTranslate(!0);var t=this.showTranslationNotify("saved");this.emitter.one("translate-mode",(function(e){e&&(null==t||t.close())})),null==t||t.on("action",(function(){e.compose.revertTranslation(),t.close()}))},onTranslationRetry:function(){this.compose.translate()},showTranslationNotify:function(e){var t="",o=fe.default.types.default,n=[];if("ok"===e)t=i18n("Переведено");if("loading"===e)t=i18n("Переводим...");if("error"===e)t=i18n("Не удалось перевести текст"),o=fe.default.types.error;if("saved"===e)t=i18n("Вы перевели письмо"),n=[{text:i18n("Отменить")}];var s={text:t,type:o,actions:n,unique:!0};return fe.default.add(s,"compose-notify")},_changeTranslateMode:function(e){this.get("form").set({"translate-mode":e,"translation-first-ok":!1})},onComposeCreateTo:function(e){this._updateComposeFields(),this.broadcast("collapse",Object.assign(this,{noAnimate:!0})),re.default.open({correspondents:{to:[e]}})},onSearchFrom:function(e){this._updateComposeFields(),this.broadcast("collapse"),this.get("router").go("#search",{},{q_from:e})},setAutosaveInterval:function(e){if(e){if(this.isMounted()){if(!this._saveDraftTimeoutId){var t=1e3*this.get("draft-timeout");if(this._saveDraftTimeoutId=setInterval(this.onAutoSave.bind(this),t),S.IS_DEBUG)console.warn("[compose-app]","Запущен таймер автосохранения. Таймаут",t,"мс")}}else if(S.IS_DEBUG)console.warn("[compose-app]","Не удалось запустить таймер автосохранения: компонент не в DOM!")}else if(clearTimeout(this._saveDraftTimeoutId),this._saveDraftTimeoutId=void 0,S.IS_DEBUG)console.warn("[compose-app]","Таймер автосохранения остановлен.")},setAutosaveOnClose:function(e){if(e)window.addEventListener("beforeunload",this.onWindowUnload);else window.removeEventListener("beforeunload",this.onWindowUnload)},getDraftUrl:function(){return this.get("router").getUrl("#letters",{folder:X().DRAFTS})},getTemplateUrl:function(){return this.get("router").getUrl("#letters",{folder:X().TEMPLATES})},isUploadingAttachments:function(){return this.get("form").isUploadingAttachments()},insertHtml:function(e){if(this.compose.appComponent)this.compose.appComponent.insertHtml(e)},updateMailboxQuotas:function(e,t){if(se.default.user.set("mbox_quotas.".concat(e),t),"attach"===e)this.get("form").resetSpaceLeft()},getPromtLogoHref:function(){return S.PROMT_LOGO_HREF}}))}}]);