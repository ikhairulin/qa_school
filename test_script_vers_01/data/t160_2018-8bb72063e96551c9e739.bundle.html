/*! For license information please see 2018-8bb72063e96551c9e739.bundle.js.LICENSE */
(self.webpackChunk_mail_octavius=self.webpackChunk_mail_octavius||[]).push([[2018],{2018:function(t,e){!function(t){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)if(e.hasOwnProperty(n))t[n]=e[n]})(t,n)};function n(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])if(Object.prototype.hasOwnProperty.call(e,a))t[a]=e[a];return t}).apply(this,arguments)},a=function(t){function e(e){var n=t.call(this,"Assertion error: "+e)||this;return n.name="AssertionError",n}return n(e,t),e}(Error);function o(t,e){if(!t||"object"!=typeof t)throw new a(e+" is not an object")}function i(t,e){if("string"!=typeof t)throw new a(e+" is not a string")}function u(t,e){o(t,e),i(t.name,e+".name"),i(t.branch,e+".branch"),function(t,e){if(!(t instanceof Date)||isNaN(+t))throw new a(e+" is not a valid Date")}(t.date,e+".date"),i(t.dateStr,e+".dateStr")}function c(t,e){if(t){var n=t.split("."),r=n[0],o=n[1];if(r&&o){var i={name:t,branch:r,date:new Date(o.replace(/_/g,":")),dateStr:o};return u(i,e),i}}throw new a(e+" is not a valid build string")}function s(t,e){return function(t,e){if(o(t,e),void 0!==t.build)i(t.build,e+".build")}(t,e),t}var f=function(t){function e(e,n){var r=t.call(this,"XHRError on url "+n+": status "+e)||this;return r.name="XHRError",r.status=e,r.url=n,r}return n(e,t),e}(Error),d=function(){function t(t,e){var n=this;if(void 0===e)e=3e4;if(this._data={},this._initialData={},this.shadowReloadPage=function(t,e){var a;n._initialData=r(r({},n._initialData),n._data),e("deploy_shadow",{i:(a={},a[n.config.name]=1,a)})},this.config=t,this.timeout=e,t.initialData)this._data=t.initialData,this._initialData=t.initialData}return Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),t.prototype.update=function(){var t,e,n=this,r=this._initialData,a="function"==typeof this.config.endpoint?this.config.endpoint():this.config.endpoint;return(t=a,e=this.timeout,new Promise((function(n,r){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)if(a.status>=200&&a.status<300)n(a.responseText);else r(new f(a.status,t))},a.open("GET",t,!0),a.timeout=e,a.send()}))).then((function(t){var e,o,i,u=JSON.parse(t),c={};if((i=u)&&"object"==typeof i&&"number"==typeof i.status){if(!function(t){return!!t.body&&"object"==typeof t.body&&t.status>=200&&t.status<300}(u))throw new f(u.status,a);c=u.body}else c=s(u,n.config.name);var d=n.config.comparator(r,c);if(n._data=c,null===(o=(e=n.config).ondata)||void 0===o||o.call(e,c,n.config),n.config.shadow&&d.changed)d.reloadPage=n.shadowReloadPage;return d}))},t}(),l=["code","errno","syscall"];function h(t){if(!t||"object"!=typeof t)return t;if("function"==typeof t.toJSON)return t.toJSON();for(var e=r(r({},t),{name:t.name,message:t.message,stack:t.stack}),n=0,a=l;n<a.length;n++){var o=a[n];e[o]=t[o]}return e}function p(t,e){return e[1]<t[1]}var _=function(){function t(t){var e=this;this._onError=function(t){var n,r=!1;if(t&&"object"==typeof t){if("AssertionError"===t.name)e._radar(["deploy_fail","upd"]);if("XHRError"===t.name)e._radar(["deploy_fail","xhr"],{i:(n={},n["status_"+t.status]=1,n)}),r=!0}e._radar("deploy_fetch-error",!r?{rlog:"deploy_fetch-error",rlog_message:t instanceof Error?h(t):{error:"unknown"}}:void 0)},this._reload=function(t){location.href=t},this._config=r({},t),this._models=this._config.sources.map((function(e){return new d(e,t.xhrTimeout)})),this._config.router.on("route-end",(function(){e._fetchAndProcessConfig()})),this._data=this._currentData()}return t.prototype._currentData=function(){for(var t={},e=0,n=this._models;e<n.length;e++)for(var r=n[e].data,a=0,o=Object.keys(r);a<o.length;a++){var i=o[a];t[i]=r[i]}return t},t.prototype._updateAll=function(){var t=this;return Promise.all(this._models.map((function(e){return e.update().catch(t._onError)}))).then((function(t){for(var e,n,r={changed:!1,reloadTimeRange:[NaN,NaN]},a=0,o=t;a<o.length;a++){var i=o[a];if(i&&i.changed){if(r.changed=!0,r.reloadPage=i.reloadPage,void 0!==i.reason)r.reason=i.reason;var u=(n=r.reloadTimeRange,Number.isNaN(n[0])||Number.isNaN(n[1])),c=(e=r.reloadTimeRange,i.reloadTimeRange[0]<e[0]),s=p(r.reloadTimeRange,i.reloadTimeRange);if(u||c&&s)r.reloadTimeRange=i.reloadTimeRange}}return r}))},t.prototype._fetchAndProcessConfig=function(){var t=this;this._updateAll().then((function(e){var n;if(e.changed){var r=c(null!==(n=t._currentData().build)&&void 0!==n?n:"","next");t._scheduleReload(r,e),t._radar("deploy_upd")}})).catch(this._onError)},t.prototype._scheduleReload=function(t,e){var n,r,a,o=this,i=(n=e.reloadTimeRange,r=n[0],a=n[1],Math.floor(Math.random()*(a-r))+r),u=1e3*i*60;if(!this._reloadTid)this._reloadTid=setTimeout((function(){if(o._reloadTid=void 0,o._config.router.one("before-route",(function(t){var n,r;if(t.target.activeRequest){var a=null!==(n=e.reloadPage)&&void 0!==n?n:o._reload,i=t.target.activeRequest.href;if(o._config.location)i=o._config.location(i);a(i,null!==(r=o._config.xraySend)&&void 0!==r?r:function(){})}})),o._radar("deploy_switch"),o._radar(["deploy_"+t.branch,t.dateStr]),void 0!==e.reason)o._radar("deploy_"+e.reason)}),u),this._radar("deploy_switch_reload_timeout",{v:i})},t.prototype._radar=function(t,e){if(this._config.xraySend)this._config.xraySend(t,e)},t}();t.appendQuery=function(t,e){return function(n){var r=encodeURIComponent(t)+"="+encodeURIComponent(e),a=n.indexOf("?")>=0;return n+(a?"&":"?")+r}},t.buildComparator=function(t,e){if(!t.build&&!e.build)return{changed:!1,reloadTimeRange:this.reloadTimeRange};if(!t.build||!e.build)return{changed:!0,reason:"upd_empty",reloadTimeRange:this.reloadTimeRange};var n=c(t.build,"current"),r=c(e.build,"next"),a=n.name===r.name;return{changed:!a,reason:a?void 0:"upd_"+(r.date>n.date?"up":"down"),reloadTimeRange:this.reloadTimeRange}},t.combine=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){for(var n=0,r=t;n<r.length;n++)e=(0,r[n])(e);return e}},t.createReleaseDetectClient=function(t){return new _(t)},t.hashComparator=function(t,e){var n=Object.keys(t),r=Object.keys(e),a=n.length===r.length&&n.every((function(n){if(""===t[n]||""===e[n])return!0;else return t[n]===e[n]}));return{changed:!a,reason:a?void 0:this.name,reloadTimeRange:this.reloadTimeRange}},Object.defineProperty(t,"__esModule",{value:!0})}(e)}}]);